<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
  <HEAD>
    <TITLE>Macro Commands</TITLE>
    <META content="text/html; charset=Windows-1252" http-equiv="Content-Type">
    <style type="text/css"> <!-- BODY { font-family:"Arial" }
  TD { font-size:16 }
      .style4
      {
        width: 241px;
      }
      .style5
      {
        width: 195px;
      }
      .style6
      {
        width: 205px;
      }
      .style7
      {
        width: 231px;
      }
      .style8
      {
        width: 215px;
      }
  --></style>
  </HEAD>
  <BODY bgColor="#ffffff" text="#000000">
    <basefont size="2">
      <P><A name="macro_commands"></A><B><FONT size="3">Macro commands</FONT></B></P>
      <P>The macro processor is case-insensitive; you can enter commands as ALLCAPS or 
        alllowercase, but for readability it is helpful to use MixedCase as in the 
        table. Completing a command by typing tab or ` will convert it to MixedCase.</P>
      <BR>
      <A href="#macro_control_commands">Macro Control Commands</A>
      <BR>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#flow_control">Flow Control Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#other_control">Other Macro Operation Control Commands</A><br>
      <A href="#camera_commands">Camera Commands</A>
      <BR>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#acquisition_param">Acquisition and Parameter Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#continuous_mode">Continuous Mode Control</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#other_camera">Other Camera Commands</A><br>
      <A href="#buffer_file_commands">Buffer and File Commands</A>
      <BR>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#buffer_image">Buffer and Image Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#file_dir">File and Directory Commands</A><br>
      <A href="#scope_filter_commands">Microscope and Filter Commands</A>
      <BR>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#stage_commands">Stage-Related Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#focus_commands">Focus-Related Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#mag_commands">Magnification-Related Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#beam_commands">Beam-Related Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#image_shift">Image Shift-Related Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#misc_scope">Miscellaneous Scope Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#filter_commands">Energy Filter Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#loader_vacuum">Autoloader, Refrigerant, and Vacuum Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#piezo_commands">Piezo Drive Commands</A><br>
      <A href="#high_level_operations">Higher Level Operations and Tasks</A>
      <BR>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#autoalign">Autoalign-Related COmmands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#autofocus">Autofocus-Related Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#low_dose">Low Dose Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#task_commands">Task-Related Commands</A><br>
      &nbsp;&nbsp;&nbsp;&nbsp; <A href="#navigator">Navigator-Related Commands</A><br>
      <A href="#miscellaneous">Miscellaneous Commands</A>
      
    <P></P>
      <P><A name="macro_control_commands"></A><B>Macro Control Commands</B></P>
      <TABLE border="1" cols="2">
       <TR  vAlign="top">
         <TD colspan="2"><A name="flow_control"></A><B>Flow Control Commands</B></TD>
       </TR>
        <TR vAlign="top">
          <TD class="style4">Repeat</TD>
          <TD>Place at end of macro to repeat it</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Loop # [variable]</TD>
          <TD>Loop the given # of times until EndLoop; optionally set variable with index</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">EndLoop</TD>
          <TD>Marks the end of the loop</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">DoMacro #</TD>
          <TD>Switches to given macro #</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">CallMacro #</TD>
          <TD>Calls other macro by # and returns</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Call text</TD>
          <TD>Calls other macro by name. Names are case-sensitive and must match exactly,
            including spaces</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Function name [#n] [s]</TD>
          <TD>Defines a function with the given name (without embedded spaces).&nbsp; The
            optional #n indicates the number of numeric arguments and s is non-zero to
            indicate that a string argument occurs after the numeric ones.&nbsp; Functions
            must be placed at the ends of macros.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">EndFunction</TD>
          <TD>Required ending to a function definition.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">CallFunction name [args]</TD>
          <TD>Calls the function with the given name and supplies arguments for the function
            to receive.&nbsp; If the name could occur in more than one macro, it must be
            qualified with a macro number or name, i.e. &#39;5::GoodFunc&#39; or &#39;Func
            Macro::GoodFunc&#39;.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">If expression</TD>
          <TD>Starts a block that is executed conditionally on the value of 'expression'</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Endif</TD>
          <TD>Ends a block started with If</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Elseif expression</TD>
          <TD>Inside of an If/Endif block, starts a block that is executed conditionally on
            the value of 'expression' if the expressions in the starting If statement and
            any preceding Elseif statements were not true.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Else</TD>
          <TD>Inside of an If/Endif block, starts a block that is executed if the expression
            after the 'If' and any preceding 'Elseif' commands is false</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Break</TD>
          <TD>Stops execution of the innermost Loop containing this statement</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">KeyBreak [key]</TD>
          <TD>If the user presses &#39;B&#39;, or the key given by the optional &#39;key&#39; entry, the
            macro breaks out of the innermost Loop containing this statement.&nbsp; &#39;key&#39;
            should be a letter or number; the test for the key is case-insensitive.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Continue</TD>
          <TD>Skips the rest of the current iteration of the innermost Loop containing this
            statement</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">SkipTo label</TD>
          <TD>Skips forward to the line starting with the given label, where the label has a
            colon (:) at the end of it and is the only item on the line.&nbsp; The colon is
            not included in the label in the SkipTo statement.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Return</TD>
          <TD>Without executing to the end of the current macro, returns to calling macro or
            ends execution if this is the top-level macro</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Exit</TD>
          <TD>Ends execution unconditionally</TD>
        </TR>
        <TR vAlign="top">
          <TD colspan="2"><A name="other_control"></A><B>Other Macro Operation
          Control Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">MacroName text</TD>
          <TD>Name the macro to the given text, which can include spaces</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">LongName text</TD>
          <TD>A longer name to appear in the Run submenu of the Macro menu; if this name is
            not defined, the regular MacroName appears there.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Delay # [units]</TD>
          <TD>Wait for given amount of time. The optional 'units' can be 'msec', 'sec', or
            'min'. If no units are given, a # &lt;= 60 is taken to be seconds, and a # &gt;
            60 is taken to be milliseconds</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Echo [text]</TD>
          <TD>Prints the text to the log window, or a blank line if there is no text.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Pause [text]</TD>
          <TD>Opens message box with optional text plus question of whether to proceed with
            macro</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">YesNoBox text</TD>
          <TD>Opens a Yes-No message box with the given text, which should be a question that
            can be answered with yes or no. Sets ReportedValue1 to 1 or 0 for a yes or no
            answer.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">EnterOneNumber text</TD>
          <TD>Opens a dialog box for the user to enter one floating point number, with the
            given text as the prompt.&nbsp; Sets ReportedValue1 to the entered value.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">EnterDefaultedNumber #V #D text</TD>
          <TD>Opens a dialog box for the user to enter one floating point or
            integer value.&nbsp; Follow with the default value to show in the box, the
            number of decimal places to show for a float entry or -1 for an integer entry,
            and the prompt text on the rest of the line.&nbsp; Sets ReportedValue1 to the
            entered value.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">FlashDisplay [#T] [#D]</TD>
          <TD>Flashes between a yellow screen and normal image display
            several times.&nbsp; The first optional entry, #T, sets the number of times to
            flash (default 4) and the second optional entry, #D, sets the duration of each
            state in seconds (default 0.3).&nbsp; Total duration may not exceed 6 seconds.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">Verbose #</TD>
          <TD>Turns echoing of each macro line on or off for # 1 or 0</TD>
        </TR>
        <TR vAlign="top">
          <TD width="210">SuppressReports</TD>
          <TD>Do not print any of these reports, just assign the values to report variables</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">ErrorsToLog [#]</TD>
          <TD>Makes most macro error messages be duplicated in the log
            window.&nbsp; Follow with a 0 to turn off the feature again.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">ClearPersistentVars</TD>
          <TD>Removes all persistent variables defined with :=</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style4">IsVariableDefined Var</TD>
          <TD>Reports whether a variable is defined, placing a 1 in
            reportedValue1 if it is and a 0 if it is not.&nbsp; Follow with the variable
            name without a $.</TD>
        </TR>
      </TABLE>
      <BR>
      <P><A name="camera_commands"></A><B>Camera Commands</B></P>
      <TABLE border="1" cols="2">
        <TR vAlign="top">
          <TD colspan="2"><A name="acquisition_param"></A><B>Acquisition and
          Parameter Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">V or View</TD>
          <TD>Acquire image with 'view' parameters</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">F or Focus</TD>
          <TD>Acquire image with 'focus' parameters</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">T or Trial</TD>
          <TD>Acquire image with 'trial' parameters</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">R or Record</TD>
          <TD>Acquire image with 'record' parameters</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">L or Preview</TD>
          <TD>Acquire image with 'preview' parameters</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">M or Montage</TD>
          <TD>Acquire montage</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">PreCookMontage #</TD>
          <TD>If montaging is enabled with stage movement, this command lowers the screen to
            expose the specimen, then moves the stage to each piece position and waits there
            for the number of seconds indicated by #.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8"><b>Set Parameter Commands</b>&nbsp;</TD>
          <TD>The following &#39;Set...&#39; commands change values in one of the camera parameter
            sets.&nbsp; The set &#39;S&#39; can be specified as either V, F, T, R, P or 0, 1, 2, 3,
            4 for view, focus, trial,
            record, preview, respectively.&nbsp; Parameters will be restored whenever the
            macro ends or stops or when a different camera is selected.&nbsp; However, if
            the macro is suspended, any changed parameters will be set again when the macro
            resumes.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">&nbsp;&nbsp;&nbsp; SetExposure S #E [#D]</TD>
          <TD>Set exposure and, optionally, drift settling for exposure set S&nbsp; to the given values E and D.&nbsp;&nbsp; If D is omitted, the existing
            drift settling will be unchanged.&nbsp;</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">&nbsp;&nbsp;&nbsp; SetBinning S #B</TD>
          <TD>Set binning for exposure set S to B.</TD>
        </TR>
        <TR>
          <TD class="style8">&nbsp;&nbsp;&nbsp; SetCameraArea S L R T B</TD>
          <TD>Set the acquisition area for exposure set S.&nbsp; Follow the set specifier S with
            either 4 numbers for the unbinned left, right, top, and bottom coordinates (the
            same kind of numbers as in the camera setup dialog) or with F, H, Q, WH or WQ
            for full, half, quarter, wide half, or wide quarter.&nbsp; Values will be adjusted
            for a legal area.&nbsp; </TD>
        </TR>
        <TR>
          <TD class="style8">&nbsp;&nbsp;&nbsp; SetCenteredSize S #B # #</TD>
          <TD>Set exposure set S for acquisition from a centered area.&nbsp; Follow the set
            specifier S with 3 numbers: the binning B, the binned size in X, and the binned
            size in Y.&nbsp; </TD>
        </TR>
        <TR>
          <TD class="style8">&nbsp;&nbsp;&nbsp; SetContinuous S #</TD>
          <TD>Set the acquisition mode for exposure set S for continuous if # is non-zero,
            or single-frame if # is 0.</TD>
        </TR>
        <TR>
          <TD class="style8">&nbsp;&nbsp;&nbsp; SetSTEMDetectors S #D...</TD>
          <TD>Set the STEM detectors for each available channel of exposure set S.&nbsp;
            Follow the set specifier S with a detector number for each channel, numbered
            from 0, or -1 to select no detector for that channel.&nbsp; At least one actual
            detector must be specified.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">RestoreCameraSet [S]</TD>
          <TD>Restore one or all camera parameter set(s) modified with the &#39;Set&#39; commands
            above.&nbsp; If S is omitted, all modified sets will be restored.</TD>
        </TR>
        <TR vAlign="top">
          <TD colspan="2"><A name="continuous_mode"></A><B>Continuous Mode Control</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">StopContinuous</TD>
          <TD>Stops continuous acquisition if it is running.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">ReportContinuous</TD>
          <TD>Returns -1 if continuous acquisition is not running, or the camera parameter
            set number being used if it is running, numbered from 0.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">UseContinuousFrames #</TD>
          <TD>If # is non-zero, the macro will keep executing commands (such as stage
            movement and alignment) even when the camera is acquiring in continuous mode.&nbsp;
            Use 0 to return to normal operation, in which the macro will wait for continuous
            acquisition to be ended by the user.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">WaitForNextFrame</TD>
          <TD>After starting a continuous acquisition, use this command to wait until the
            next image becomes available.&nbsp; The program will wait until the exposure
            time has elapsed so that the image is likely to be taken after completion of
            previous operations. The &#39;UseContinuousFrames 1&#39; command must be used before the
            acquisition is started.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">SetLiveSettleFraction #</TD>
          <TD>Set the fraction of the usual settling time to apply in continuous mode after
            image shift or stage movement.&nbsp; By default, no settling is applied in
            continuous mode (i.e., the fraction is 0), but some settling may be needed when
            a macro or other operation is using continuous frames.&nbsp; The fraction is
            reset to zero when continuous mode ends.</TD>
        </TR>
        <TR vAlign="top">
          <TD colspan="2"><A name="other_camera"></A><B>Other Camera Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">CameraProperties</TD>
          <TD>Report unbinned size in X and Y of current camera</TD>
        </TR>
        <TR>
          <TD class="style8">SelectCamera #</TD>
          <TD>Make the given camera (numbered from 1) be the active camera.&nbsp; Will switch
            in and out of EFTEM mode or STEM mode if appropriate.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">RetractCamera</TD>
          <TD>Retracts all retractable cameras</TD>
        </TR>
        <TR>
          <TD class="style8">OppositeFocus</TD>
          <TD>In low dose mode, acquire Focus image from area on opposite side of Record from
            the defined&nbsp;Focus area.&nbsp; Opposite areas are not available if Balance
            Shifts is turned on.</TD>
        </TR>
        <TR>
          <TD class="style8">OppositeTrial</TD>
          <TD>In low dose mode, acquire&nbsp;Trial image from area on opposite side of Record
            from the&nbsp;defined&nbsp;Trial area.</TD>
        </TR>
        <TR>
          <TD class="style8">StepFocusNextShot # # [# #]</TD>
          <TD>Do one or two focus changes during the next exposure.&nbsp; Follow with 2 or 4
            numbers: the time in seconds from start of the exposure to the first focus
            change, the first focus change in microns, the time from start of the exposure
            to the second focus change if any, and the second focus change relative to the
            starting focus, not relative to the focus after the first change.&nbsp; The
            command will have no effect if the exposure time is less than the time to the&nbsp;
            first change, and the second change will not be done if the time for it is
            greater than the exposure time.</TD>
        </TR>
        <TR>
          <TD class="style8">SmoothFocusNextShot # #</TD>
          <TD>Change focus linearly through next exposure.&nbsp; Follow with 2 numbers, the
            starting and ending defocus relative to the current focus.&nbsp; This command
            and StepFocusNextShot are enabled for Gatan, Falcon, and Tietz cameras.</TD>
        </TR>
        <TR>
          <TD class="style8">EarlyReturnNextShot #</TD>
          <TD>Return as early as possible from the next acquisition, which must involve
            saving dose-fractionation frames from a K2 camera.&nbsp; Follow with the number
            of frames to be summed in the returned image, 0 to return without any summed
            image, or -1 to return with the full sum (the latter is available only on GMS
            2.31 or higher).&nbsp; Single-shot and dose-fractionation images can be
            requested without delay in the macro.&nbsp; The single-shot images will be taken
            as soon as possible (after the end of the exposure before GMS 2.31, after the
            frame stack has been accessed in GMS 2.31 and higher).&nbsp; Another
            dose-fractionation shot will be delayed until saving is finished for the current
            shot.</TD>
        </TR>
        <TR>
          <TD class="style8">DeferStackingNextShot</TD>
          <TD>Do not stack Falcon intermediate frames after the next exposure.&nbsp; To
            stack frames from multiple exposures into one stack, use this command before
            each exposure except the last one.</TD>
        </TR>
        <TR>
          <TD class="style8">OpenDECameraCover</TD>
          <TD>Opens the protection cover of the Direct Electron camera for the remainder of
            the macro, if it is the current camera.&nbsp; Without this command, the cover
            will be opened and closed for each exposure except during tasks.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style8">UpdateHWDarkRef #</TD>
          <TD>Updates the K2 hardware dark reference if the known interval since the last
            update is longer than # in hours.&nbsp; If # is 0, the update is done
            unconditionally; if # is negative (-1), it simply records the current time as
            the time of the last update. </TD>
        </TR>
      </TABLE>
      <BR>
      <P><A name="buffer_file_commands"></A><B>Buffer and File Commands</B></P>
      <TABLE border="1" cols="2">
        <TR vAlign="top">
          <TD colspan="2"><A name="buffer_image"></A><B>Buffer and Image Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">Copy buf1 buf2</TD>
          <TD>Copy from buf1 to buf2 (e.g., Copy C A)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">Show buf</TD>
          <TD>Display the given buffer (e.g., Show C)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">CropImage buf x0 x1 y0 y1</TD>
          <TD>Crop out a subarea of the given buffer from x0 to x1 in X and from y0 to y1 in
            Y. Coordinates are numbered from 0 to size - 1 in each dimension and 0 in Y is
            at the top.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">ImageProperties [buf]</TD>
          <TD>Report size in X and Y, binning, exposure, pixel size, and parameter set
            used&nbsp;for the image in buffer A or in the buffer indicated by 'buf'</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">ImageLowDoseSet [buf]</TD>
          <TD>Report the parameter set that an image was taken with and whether it was taken
            in Low Dose mode, for the image in buffer A or in the buffer indicated by 'buf'.&nbsp;
            For one of the 5 standard parameter sets, it will report the set name.&nbsp; For
            a montage image, it will report Record.&nbsp; For a tracking image, it will
            report View if the mag matches that of View in Low Dose; if the mag matches
            Record in Low Dose, it will report Record or Preview depending on which has an
            closest exposure time closest to that of the image.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">ReportMeanCounts [buf] [#]</TD>
          <TD>Report the mean counts of the A buffer, or of the buffer indicated by 'buf';
            add a 1 to get unbinned counts per second</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">ElectronStats [buf]</TD>
          <TD>Report the min, max, mean, and SD of the A buffer, or of the buffer indicated
            by &#39;buf&#39;, scaled to electrons, and also report the electrons per unbinned pixel
            per second.&nbsp; The camera must have a defined counts per electron.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">SubareaMean x0 x1 y0 y1</TD>
          <TD>Report the mean counts in a subarea of the A buffer from x0 to x1 in X and from
            y0 to y1 in Y. Coordinates are numbered from 0 to size - 1 in each dimension
            and 0 in Y is at the top.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">QuadrantMeans [n] [f1] [f2]</TD>
          <TD>Report means of strips along quadrant boundaries. Optional entries are 'n' for
            the number of pixels between strip and boundary (default 2), 'f1' for the strip
            width as a fraction of quadrant extent (default 0.1), and 'f2' for the fraction
            of quadrant extent to trim off the length of the strip (default 0.1). Output is
            labeled by quadrant number (1 to 4) and 'h' for horizontal strips or 'v' for
            vertical strips.</TD>
        </TR>
        <TR vAlign="top">
          <TD colspan="2"><A name="file_dir"></A><B>File and Directory Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">S or Save [buf] [file #]</TD>
          <TD>Save image in A or in buf to current open file, or to the given file number</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">SetDirectory dir</TD>
          <TD>Change the working directory to 'dir', which can contain spaces.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">UserSetDirectory [prompt]</TD>
          <TD>Open a directory chooser dialog to allow user to select or make a directory,
            and change the working directory to it.&nbsp; If the optional prompt string is
            not supplied, the dialog title is &#39;Choose a new current working directory&#39;.&nbsp;
            The chosen directory is stored in ReportedValue1.</TD>
        </TR>
        <TR>
          <TD class="style7">MakeDirectory dir</TD>
          <TD>Create the directory 'dir' if it does not already exist.&nbsp; 'dir' can
            contain spaces.&nbsp; The parent directory must already exist.</TD>
        </TR>
        <TR>
          <TD class="style7">MakeDateTimeDir</TD>
          <TD>Create a directory named by the date and time (e.g., Aug15_12.23.15) under the
            current directory and change to this as the new working directory.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">SetNewFileType # [#]</TD>
          <TD>Set to 0 to open files as MRC, or 1 to open files as a TIFF series described in
            an image autodoc file. The optional second value sets whether to open montaged
            files as MRC or as a TIFF series, but only if the property
            MontageAutodocOptions is set.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">OpenNewFile file</TD>
          <TD>Open a file with the given name, which can contain spaces. The file properties
            dialog will be bypassed. Since the current working directory can be
            unpredictable, depending on whether the user has opened a file with the file
            chooser, it is advisable either to specify an absolute path for the filename,
            or use a 'SetDirectory' with an absolute path.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">OpenNewMontage #x #y file</TD>
          <TD>Open a file with the given name for montaging, with the number of frames in X
            and Y given by '#x' and '#y'. If either #x or #y is 0, the number of frames
            will be taken from the last montage that was open. The file properties and
            montage setup dialogs will be bypassed, and some properties like overlap and
            whether to do a stage montage will be taken from the last montage that was
            open.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">SetupWaffleMontage #B file</TD>
          <TD>Open a montage file or adjust the current file&#39;s properties so that it will
            hold an image of the cross-line (waffle) replica grating with at least #B blocks
            in X and Y at the current magnification. Follow with the minimum # of blocks and
            the name of the file to be opened if necessary.&nbsp; If montaging is not
            needed, no changes are made.&nbsp; If there is an existing montage that is
            adequate, its properties will be adjusted to work at the current mag.&nbsp; If a
            new montage is needed, it will close the current file if it is a montage and
            open a new one with the given name.&nbsp; Variables will be substituted, so the
            name can contain the mag index, for example. It sets reportedValue1 to 1 or 0
            depending on whether montaging is needed or not. </TD>
        </TR>
        <TR>
          <TD class="style7">EnterNameOpenFile [prompt]</TD>
          <TD>Get a filename through a dialog with a simple text box and open it as a new
            file.&nbsp; If the optional prompt string is not supplied, the prompt is &quot;Enter
            name for new file:&quot;.</TD>
        </TR>
        <TR>
          <TD class="style7">OpenFrameSumFile suffix</TD>
          <TD>Open a file whose name starts with the last name used for saving
            frames from a K2 or Falcon camera, and ends with the string given in the command.&nbsp;
            The string can contain spaces and variables. </TD>
        </TR>
        <TR>
          <TD class="style7">AllowFileOverwrite #</TD>
          <TD>Allow 'OpenNewFile' and 'OpenNewMontage' to overwrite an existing file if # is
            1, or disallow it again if # is 0.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">OpenOldFile file</TD>
          <TD>Open an existing MRC or ADOC file with the given name, which can contain
            spaces.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">ReadFile # [buf]</TD>
          <TD>Reads the given section # (numbered from 0) from the current open file into
            the standard Read buffer, or into the buffer indicated by the optional &#39;buf&#39;</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">CloseFile [e]</TD>
          <TD>Close the current file. Enter optional 'e' to stop macro if no file is open.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">SwitchToFile #</TD>
          <TD>Make the given file number be the current open file.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">ReportFileZsize</TD>
          <TD>Report the number of frames in currently open file</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">SetMontageParams # [# # # # #]</TD>
          <TD>Sets up to 6 montage parameters; enter a value or -1 to leave the parameter
            unchanged. The entries are: 1 to use stage movement or 0 not to; overlap in X;
            overlap in Y; frame size in X; frame size in Y, 1 to skip correlations or 0 not
            to.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">AddToAutodoc key value</TD>
          <TD>Adds a key-value pair to the last section of the autodoc associated with the
            current open file, if any.&nbsp; The next word after the command is the key, and
            the remainder of the text on the line is taken as the value.&nbsp; Variables are
            substituted before using the text.&nbsp; After one or more additions to a
            section of the autodoc, a WriteAutodoc command must be used to save the values
            before closing the file or saving another image to it.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">WriteAutodoc</TD>
          <TD>Writes the autodoc associated with the current open file.&nbsp; Use this
            command once after adding one or more values to a section of the autodoc.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">AddToFrameMdoc key value</TD>
          <TD>Adds a key-value pair to the last section of the autodoc opened with the
            <a href="menu_file.htm#hid_file_open_mdoc">Open .mdoc for Frames</a> command.&nbsp; 
            This works just like AddToAutodoc, but the WriteFrameMdoc command must be used 
            instead after adding values.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">WriteFrameMdoc</TD>
          <TD>Writes the frame autodoc file; use this command after adding one or more 
            values to a section.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">ReportFrameMdocOpen</TD>
          <TD>Reports whether a frame .mdoc file is open; sets ReportedValue1 to 1 if so.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style7">SaveLogOpenNew</TD>
          <TD>Closes the log window and opens a new one.&nbsp; If a log file has been saved, 
            the log is automatically saved to it before closing.&nbsp; If there is no log 
            file and the log has new contents since program startup, the program will ask 
            the user whether to save to log first; if the user cancels, the macro is 
            aborted.</TD>
        </TR>
      </TABLE>
      <BR>
      <P><A name="scope_filter_commands"></A><B>Microscope and Filter Control Commands</B></P>
      <TABLE style="Z-INDEX: 0" border="1" cols="2">
        <TR vAlign="top">
          <TD colspan="2"><A name="stage_commands"></A><B>Stage-Related Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">U or TiltUp</TD>
          <TD>Tilt up by preset increment</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">D or TiltDown</TD>
          <TD>Tilt down by preset increment</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">TiltTo #</TD>
          <TD>Tilt to given angle</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">TiltBy #</TD>
          <TD>Change tilt by the given amount</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportTiltAngle</TD>
          <TD>Report current tilt angle</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">MoveStage #X #Y #Z</TD>
          <TD>Move stage by micron increments in X, Y, Z (Z optional)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">MoveStageTo #X #Y #Z</TD>
          <TD>Move stage to given position in microns. Z is optional and Z will not be
            changed if it is omitted.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportStageXYZ</TD>
          <TD>Report current stage position</TD>
        </TR>
        <TR vAlign="top">
          <TD colspan="2"><A name="focus_commands"></A><B>Focus-Related Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ChangeFocus #</TD>
          <TD>Change defocus by the given value in microns</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetDefocus #</TD>
          <TD>Set the defocus to the given value in microns</TD>
        </TR>
        <TR>
          <TD class="style6">SetAbsoluteFocus #</TD>
          <TD>Set focus to a an absolute (standardized)&nbsp;value as reported earlier by
            ReportAbsoluteFocus or ReportFocus</TD>
        </TR>
        <TR>
          <TD class="style6">SetStandardFocus #</TD>
          <TD>Same as &#39;SetAbsoluteFocus&#39;, which is preferred to avoid confusion with the
            calibrated standard or eucentric focus value</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetObjFocus #</TD>
          <TD>Calls SetObjFocus on JEOL with the given #, an integer increment, and reports
            change in focus</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportDefocus</TD>
          <TD>Report current defocus readout in microns</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportAbsoluteFocus</TD>
          <TD>Report an absolute (standardized) value for the current focus setting</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportFocus</TD>
          <TD>Same as &#39;ReportAbsoluteFocus&#39;, which is a better description of the operation</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetEucentricFocus</TD>
          <TD>If in low mag, sets to the standard focus for the current mag or nearest LM
            mag if one has been set; otherwise on FEI it assumes standard focus is 0 and on
            JEOL it stops with an error.&nbsp; If not in LM, sets to the standard focus for
            the nearest nonLM mag if one has been set or stops with an an error if none were
            set.&nbsp; On FEI scopes, it issues a warning if it is using a calibrated value
            from a different mag.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">CalEucentricFocus</TD>
          <TD>Stores the current standardized focus value as the standard focus for the
            current mag, just as the Calibrate menu item
            <a href="menu_calibration.htm#hid_calibration_standardlmfocus">Standard Focus</a>
            does.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SaveFocus</TD>
          <TD>Saves the current focus; the focus will be restored to this value either by
            RestoreFocus or when the macro stops or exits.&nbsp; The macro will not be
            resumable if it stops.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">RestoreFocus</TD>
          <TD>Restores the focus value when SaveFocus was run.&nbsp; After this is run, the
            focus will not be restored again when the macro ends.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ResetDefocus</TD>
          <TD>Sets the defocus readout to 0, just as
            <a href="menu_focus.htm#hid_focus_resetdefocus">Reset Defocus</a> in Focus menu
            does.</TD>
        </TR>
        <TR vAlign="top">
          <TD colspan="2"><A name="mag_commands"></A><B>Magnification-Related Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetMag #</TD>
          <TD>Set the mag to an actual film mag value</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ChangeMag #</TD>
          <TD>Change mag by given number of mag steps</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportMag</TD>
          <TD>Report the current mag; also set ReportedValue2 to 1 if low mag mode, 0 if not</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportMagIndex</TD>
          <TD>Report the current mag index; also set ReportedValue2 to 1 if low mag mode, 0
            if not</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetCamLenIndex #</TD>
          <TD>Set the camera length index to the given number; on the Tecnai, values higher
            than 30 set the index to (# - 30) in LAD mode</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetMagAndIntensity #</TD>
          <TD>Set the mag to the actual film mag value and change the beam to maintain the
            same brightness. Two values are reported: the initial percent C2 value and the
            remaining factor of intensity change needed if it was not possible to change
            the intensity by the full amount needed. The C2 value should be used to restore
            intensity when the mag is restored. The remaining intensity change could be
            applied to the exposure time if necessary. The macro will stop if there is an
            error in the intensity change.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ChangeMagAndIntensity #</TD>
          <TD>Change mag by the given number of mag steps and change the beam to maintain the
            same brightness. Behaves same as SetMagAndIntensity.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">IncMagIfFoundPixel #</TD>
          <TD>Increase or decrease mag by one step if the pixel size has been found at the
            current mag with the <a href="menu_calibration#hid_process_findpixelsize">Find Pixel Size</a>
            routine, depending on whether # is positive or negative.&nbsp; Sets
            reportedValue1 to 1 if the mag is changed, 0 otherwise.</TD>
        </TR>
        <TR vAlign="top">
          <TD colspan="2"><A name="beam_commands"></A><B>Beam-Related Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetSpotSize #</TD>
          <TD>Set the spot size to the given number</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportSpotSize</TD>
          <TD>Report the current spot size</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetPercentC2 #</TD>
          <TD>Set the C2/C3 lens strength to the given percentage, or illuminated area on
            Titan to given value in microns.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">IncPercentC2 #</TD>
          <TD>Change the C2/C3 lens strength percentage or illuminated area in microns by the given amount</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportPercentC2</TD>
          <TD>Report the percent C2/C3 (on the Tecnai, this number matches the value in TUI)
            and the fractional lens strength.&nbsp; On a Titan, if illuminated area is being
            used for intensity, this reports the illuminated area value.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportIlluminatedArea</TD>
          <TD>Report the illuminated area on a Titan</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetIntensityForMean #</TD>
          <TD>Adjust beam intensity to yield the given number of counts, based on counts in
            the tilt-foreshortened area of the image in A. In low dose mode, this operates
            only on Record images and will change the intensity only of the Record area.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetIntensityByLastTilt</TD>
          <TD>Adjust beam intensity by the change in cosine of the tilt angle from the last
            tilt change. In low dose mode, this changes the intensity only of the Record
            area.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ChangeIntensityBy #</TD>
          <TD>Change beam intensity by the given factor using calibrations. In low dose mode
            this changes the intensity of the current area.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetAlpha #</TD>
          <TD>Sets alpha value on JEOL.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportAlpha</TD>
          <TD>Reports alpha value on JEOL.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetBeamShift #X #Y</TD>
          <TD>Set the beam shift to the given values (nominal micron units)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportBeamShift</TD>
          <TD>Report the beam shift in nominal micron units</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetBeamTilt #X #Y</TD>
          <TD>Set the beam tilt to the given values (milliradians or % of full scale)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportBeamTilt</TD>
          <TD>Reports the beam tilt in milliradians for FEI, % of full-scale value for JEOL</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetProbeMode #</TD>
          <TD>Sets the mode to microprobe or nanoprobe on an FEI scope.&nbsp; Follow with 0 
            or &quot;nano&quot; for nanoprobe, or 1 or &quot;micro&quot; for microprobe.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportProbeMode</TD>
          <TD>Reports whether an FEI scope is in nanoprobe or microprobe mode; sets first 
            reported value to 0 or 1, respectively.</TD>
        </TR>
        <TR vAlign="top">
          <TD colspan="2"><A name="image_shift"></A><B>Image Shift-Related Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetImageShift #X #Y</TD>
          <TD>Set the image shift to the given values (image shift units).&nbsp; The values
            correspond to the ones give by ReportImageShift, which are adjusted for tilt
            axis offset, image shift offset, and low dose area shift</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ImageShiftByPixels #X #Y</TD>
          <TD>Change image shift by given # of pixels in camera X and Y</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ImageShiftByUnits #X #Y</TD>
          <TD>Change image shift by given # of IS units in X &amp; Y</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ImageShiftByMicrons #X #Y</TD>
          <TD>Change image shift by given distance on specimen (X is tilt axis)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportImageShift</TD>
          <TD>Report the image shift in IS units, adjusted for tilt axis offset, image shift
            offset, and low dose area shift; also report the equivalent shift in unbinned 
            pixels on the current camera at the current magnification, if image shift is 
            calibrated.&nbsp; Positive values of the latter will result from an image shift 
            imposed by dragging an image to the upper right.</TD>
        </TR>
        <TR  vAlign="top">
          <TD colspan="2"><A name="misc_scope"></A><B>Miscellaneous Scope Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetObjectiveStigmator #X #Y</TD>
          <TD>Set the objective lens stigmator to the given values (between -1 and 1)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportObjectiveStigmator</TD>
          <TD>Report the X and Y values of the objective stigmator, between -1 and 1</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetBeamBlank #</TD>
          <TD>Blank beam if # is 1, unblank if # is 0</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">NormalizeLenses #</TD>
          <TD>Normalize selected lenses on an FEI or Hitachi scope; # is the sum of 1 for projector, 2
            for objective, 4 for condenser lenses</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">NormalizeAllLenses [#]</TD>
          <TD>Normalize all lenses, or in a lens group, on an FEI scope.&nbsp; With # 0 or
            not present, it normalizes all lenses in one call.&nbsp; Otherwise, # can be the
            sum of 1 to normalize the illumination group (which includes condenser,
            minicondenser, and objective lenses) and 2 to normalize the projection group (which includes objective and projector
            lenses) in a separate call.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetColumnOrGunValve #</TD>
          <TD>Close column/gun valve or turn off filament if # is 0; open valve or turn on
            filament if # is 1</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ScreenUp</TD>
          <TD>Raise the main screen</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ScreenDown</TD>
          <TD>Lower the main screen</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ManualFilmExposure #</TD>
          <TD>Film exposure time in seconds for manual exposures, or 0 for automatic exposure
            (the default)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ExposeFilm</TD>
          <TD>Take a film exposure</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SpecialExposeFilm # [#] [#]</TD>
          <TD>Expose film with special handling: the first # specifies a delay in seconds
            after loading the plate; the second # specifies a pre-exposure of the specimen
            before exposing the plate, in seconds. The third # suppresses dimming of the
            screen if it is nonzero.  This command command does not raise the
            screen if it is down. It requires the adaexp server to be installed.</TD>
        </TR>
        <TR  vAlign="top">
          <TD colspan="2"><A name="filter_commands"></A><B>Energy Filter Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetSlitWidth #</TD>
          <TD>Set energy filter slit width in eV</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetSlitIn [#]</TD>
          <TD>Insert the slit; or if # is entered, insert if 1 or retract if 0</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SetEnergyLoss #</TD>
          <TD>Set the energy loss to the #</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ChangeEnergyLoss #</TD>
          <TD>Change the energy loss by the #</TD>
        </TR>
        <TR>
          <TD class="style6">ReportEnergyFilter</TD>
          <TD>Report the slit width, energy loss, and whether the slit is in or out (the
            latter is placed in ReportedValue3 as a 1 or 0)</TD>
        </TR>
        <TR  vAlign="top">
          <TD colspan="2"><A name="loader_vacuum"></A><B>Autoloader,
          Refrigerant, and Vacuum Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">LoadCartridge #</TD>
          <TD>Loads the cartridge from the given slot # (numbered from 1) if there is an
            autoloader.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">UnloadCartridge</TD>
          <TD>If there is an autoloader, unloads the cartridge.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportSlotStatus #</TD>
          <TD>Report the status of the cartridge slot given by # (numbered from 1) if there
            is an autoloader.&nbsp; Status is -1 for an error, 0 for empty, and 1 for
            occupied.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">AreDewarsFilling</TD>
          <TD>Report whether any of the dewars in a temperature control system are busy
            filling (reported value 1 is set to 0 or 1)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">DewarsRemainingTime</TD>
          <TD>Report the time remaining for until next automatic dewar filling, or -1 if
            none is scheduled</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">RefrigerantLevel #</TD>
          <TD>Report the refrigerant level of the given dewar: 1 for autoloader, 2 for
            column, 3 for liquid helium</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">IsPVPRunning</TD>
          <TD>Report whether the PVP is running on an FEI scope.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">LongOperation Op # [Op #...]</TD>
          <TD>Starts one or more time-consuming operations: Buffer cycle (Bu), Refill
            refrigerant (Re), Inventory cassettes (In), Loader buffer cycle (Lo), Dark
            reference update for K2 (Da).&nbsp; Operations are identified by the first two
            letters of whatever full word you use (case insensitive).&nbsp; Each operation
            except Inventory must be followed by an interval in hours (#).&nbsp; If # is &gt;
            0, the operation is done only if the time since the last such operation is
            greater than #; if # is 0, the operation is done unconditionally; if # is &lt; 0, it
            simply records the current time as the time of the last operation.&nbsp;&nbsp; The scope operations will occur sequentially
            and be started in &nbsp;the order that they are listed. The dark reference update
            will be done simultaneously with scope operations.&nbsp; If an error occurs in a
            scope operation, other operations will be finished and the error reported at the
            end.&nbsp; Errors other than in refilling refrigerant will cause the macro to
            stop.&nbsp; The user
            interface should not hang during long operations, and users will be asked to confirm that they want to
            kill the operation threads if they press STOP or try to exit the program.&nbsp;
            The consequences of killing these threads are uncertain.</TD>
        </TR>
        <TR  vAlign="top">
          <TD colspan="2"><A name="piezo_commands"></A><B>Piezo Drive Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">SelectPiezo # #</TD>
          <TD>Select a piezo drive for reports or movements, follow with the plugin number
            (numbered from 0, enter 0 if there is only one plugin controlling piezos) and
            the piezo number (numbered from 0).</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportPiezoXY</TD>
          <TD>Reports the X and Y position of the currently selected piezo</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">ReportPiezoZ</TD>
          <TD>Reports the Z position, or the position of the only axis for a single-axis
            piezo, of the currently selected piezo</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">MovePiezoXY #X #Y [#]</TD>
          <TD>Sets the X and Y position of the currently selected piezo to #X, #Y, or if the
            optional third # is non-zero, moves the piezo by #X, #Y</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style6">MovePiezoZ #Z [#]</TD>
          <TD>Sets the Z position, or position of a single-axis piezo, to #Z for the
            currently selected piezo, or if the optional second # is non-zero, moves the
            piezo by #Z</TD>
        </TR>
      </TABLE>
      <BR>
      <P><A name="high_level_operations"></A><B>Higher Level Operations and Tasks</B></P>
      <TABLE border="1" cols="2">
        <TR  vAlign="top">
          <TD colspan="2"><A name="autoalign"></A><B>Autoalign-Related Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">A or Autoalign</TD>
          <TD>Align buffer A to autoalign buffer</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">AlignTo buffer_letter [noIS]</TD>
          <TD>Align buffer A to given buffer (e.g. B). Optionally, enter 1 for 'noIS' to
            avoid changing microscope image shift</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ClearAlignment</TD>
          <TD>Clear the alignment shift of the image in buffer A</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ConicalAlignTo buf # [show]</TD>
          <TD>Align buffer A to the given buffer 'buf' assuming a specimen rotation given by
            #. Optionally, enter 1 for 'show' to show the cross-correlation.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ReportAlignTrimming</TD>
          <TD>Report the sum of left and right borders and the sum of top and bottom borders
            in the last autoalign for the image in A and for the reference image.&nbsp; The
            numbers are in pixels of the respective images before the additional binning
            applied for correlation, and will thus differ from the binned values reported by
            the autoalign routine.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ReportAlignShift</TD>
          <TD>Report the X and Y alignment shift of the current image in A in unbinned pixels
            on image, in nanometers along the image shift axes, and in nanometers on the
            specimen, where the tilt axis is along X.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ReportShiftDiffFrom #</TD>
          <TD>Report the difference between the alignment shift of the current image and the
            given value in microns, as percentage of the value; the cumulative sum of
            differences in microns, and the total sum of shifts in microns. For monitoring
            variability in successive stage movements.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ReportAccumShift</TD>
          <TD>Report sum of shifts given by ReportAlignShift or ReportShiftDiffFrom</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ResetAccumShift</TD>
          <TD>Reset the sum of shifts given by ReportAlignShift to 0 or ReportShiftDiffFrom</TD>
        </TR>
        <TR  vAlign="top">
          <TD colspan="2"><A name="autofocus"></A><B>Autofocus-Related Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">G or Autofocus [#] [#]</TD>
          <TD>Autofocus; set optional first # to -2 to measure shift and drift, -1 to just measure defocus without changing,
            or 1 for normal autofocus that changes focus to target; set optional second # to 1
            to focus with View area in Low Dose mode.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">IncTargetDefocus #</TD>
          <TD>Change the defocus target by #</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">SetTargetDefocus #</TD>
          <TD>Set the defocus target to #</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">BeamTiltDirection #</TD>
          <TD>Set beam tilt direction for autofocusing to # (a value from 0 to 3)</TD>
        </TR>
        <TR>
          <TD class="style5">OppositeAutofocus [#]</TD>
          <TD>In low dose mode, autofocus in area on opposite side of Record from the defined
            Focus area; if optional # is -1, just measure defocus without changing.&nbsp;
            Not available if Balance Shifts is on.</TD>
        </TR>
        <TR>
          <TD class="style5">FocusChangeLimits # #</TD>
          <TD>Set limits on the focus change during autofocus runs for the remainder of the
            macro; follow with a negative and a positive number for the limits in microns.&nbsp;
            When an autofocus run exceeds a limit, it will abort and return to the starting
            defocus.&nbsp; Enter with 0 0 to cancel these limits.</TD>
        </TR>
        <TR>
          <TD class="style5">AbsoluteFocusLimits # #</TD>
          <TD>Set limits on the absolute focus reached during autofocus runs.&nbsp; Follow
            with a lower and a upper limit as given by ReportAbsoluteFocus, or 0 0 to cancel
            these limits.&nbsp; Autofocus will abort when a limit is exceeded.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ReportFocusDrift</TD>
          <TD>Report the drift estimate from the last autofocus, if available</TD>
        </TR>
        <TR>
          <TD class="style5">ReportAutofocus</TD>
          <TD>Report measured defocus from last autofocus</TD>
        </TR>
        <TR>
          <TD class="style5">ReportTargetDefocus</TD>
          <TD>Report the defocus target</TD>
        </TR>
        <TR  vAlign="top">
          <TD colspan="2"><A name="low_dose"></A><B>Low Dose Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">GoToLowDoseArea area</TD>
          <TD>Switches to the low dose area given by 'area', which must be one of V, F, T, R,
            or S. This will not work if the screen is down.
          </TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">SetLowDoseMode #</TD>
          <TD>Turns low dose mode on for # nonzero or off for # 0; the previous state of low
            dose is saved in ReportedValue1 as a 0 or 1.</TD>
        </TR>
        <TR>
          <TD class="style5">ReportLowDose</TD>
          <TD>Report whether low dose is on or not and the current area, if it is defined.&nbsp;
            The number of the area (0 for V, etc.) is placed in ReportedValue2.</TD>
        </TR>
        <TR>
          <TD class="style5">SetAxisPosition F/T #D [#A]</TD>
          <TD>Modifies the axis position, and optionally the rotation of the inter-area 
            axis, for the Focus and/or Trial area.&nbsp; Follow with F or T to specify the 
            area (both will be changed if Focus and Trial settings are being kept 
            identical); with #D, the distance in microns; and optionally with #A, a rotation 
            angle.&nbsp; If an angle is set, the option to apply the angle will be turned on 
            in the Low Dose control panel.&nbsp; Low dose mode must be on to use this 
            command.</TD>
        </TR>
        <TR  vAlign="top">
          <TD colspan="2"><A name="task_commands"></A><B>Task-Related Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ResetImageShift [1]</TD>
          <TD>Reset image shift and move stage to compensate.&nbsp; Follow with an optional 
            1 to move the stage so as to retain or impose backlash, even if the user has not 
            selected the option to do so in the Image Alignment &amp; Focus control panel.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ResetShiftIfAbove #</TD>
          <TD>Reset image shift and realign image if image shift is greater than the given #
            in microns</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">Eucentricity [#]</TD>
          <TD>Refine eucentricity, or if optional # is entered, do rough eucentricity only
            (1), refine only (2), both steps (3), or refine and realign (6)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ReportLastAxisOffset</TD>
          <TD>Reports the lateral offset of the tilt axis estimated from the last Refine 
            Eucentricity run; aborts the macro if no offset is available.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">WalkUpTo #</TD>
          <TD>Tilt up to given angle in steps and track image position</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ReverseTilt [#]</TD>
          <TD>Work out backlash and realign image after reversing tilt direction; enter
            optional 1 or -1 to specify a specific direction for further tilts</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">RefineZLP [#]</TD>
          <TD>Report time of day and run Refine Zero Loss Peak procedure.&nbsp; If the 
            optional # is entered with an interval in minutes, the procedure is not run if 
            the time since the last run is less than that interval.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">AutocenterBeam</TD>
          <TD>Start the Beam Autocenter routine</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">CookSpecimen</TD>
          <TD>Run the Specimen Cooker routine</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">WaitForDose #d [#r]</TD>
          <TD>Start accumulating dose and wait until it reaches the given #d in electrons per
            square Angstrom. Enter the optional #r to set how many times it reports
            progress while waiting (default is 10). Be sure that the screen is down and, if
            in low dose, that the beam is unblanked.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">CenterBeamFromImage [#]</TD>
          <TD>Center beam using the existing image in the active buffer by detecting the
            edges of the beam, or from the centroid of the image intensities if # is
            nonzero. In the latter case the beam should be completely within the camera
            field.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">CalibrateImageShift [#]</TD>
          <TD>Calibrate image shift at the current mag. Do the calibration from scratch if
            the optional # is nonzero.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ShiftCalSkipLensNorm [0]</TD>
          <TD>Keeps projector lens normalization from being done before the next image or 
            stage shift calibration provided that normalization was last done at the current 
            magnification.&nbsp; Follow with an optional 0 to NOT skip normalization.</TD>
        </TR>
        <TR>
          <TD class="style5">FindPixelSize</TD>
          <TD>Run the routine to find the pixel size in an image of a cross-line grating.</TD>
        </TR>
        <TR>
          <TD class="style5">QuickFlyback set# #e</TD>
          <TD>Run the camera timing calibration routine in quick flyback mode for an FEI
            STEM camera, where 'set#' specifies the camera parameter set and must be V, F,
            T, R, or P, and #e is the exposure time to use.&nbsp; The routine will not ask for
            confirmation before saving the resulting flyback time and startup delay in the
            master list of flyback times.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ShiftImageForDrift # # #</TD>
          <TD>Apply image shift during the next exposure to compensate for a drift in X and Y
            given by the first and second numbers; the third number should be 0 if the
            drift is in unbinned pixels/sec and 1 if it is in nm/sec</TD>
        </TR>
        <TR  vAlign="top">
          <TD colspan="2"><A name="navigator"></A><B>Navigator-Related Commands</B></TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">NewMap</TD>
          <TD>Make the current image or montage a new Navigator map</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">MoveToNavItem [#]</TD>
          <TD>Move the stage to a Navigator item; if no # is entered, move to the current
            Navigator item or to the item that this macro is being run on, otherwise move
            to the item whose index in the table is # (numbered from 1)</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">RealignToNavItem #r [#c]</TD>
          <TD>Realign to the current Navigator item, or to the item that this macro is being
            run on. For #r, enter 1 to restore the microscope state to the current state
            after the procedure, or 0 not to.&nbsp; For optional #c, enter 1 to use
            continuous acquisition mode and end it at end of procedure, or 2 to leave it
            running if possible.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">RealignToOtherItem #i #r [#c]</TD>
          <TD>Realign to the Navigator item whose index in the table is #i, numbered from 1.
            For #r, enter 1 to restore the microscope state to the current state after the
            procedure, or 0 not to.&nbsp; For optional #c, enter 1 to use continuous
            acquisition mode and end it at end of procedure, or 2 to leave it running if
            possible.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ForceCenterRealign</TD>
          <TD>Makes Realign to Item align to the map center instead of skipping the first
            round because it was aligned to recently</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ShiftItemsByAlignment</TD>
          <TD>Shift items at the current registration by the alignment shift of the image in
            buffer A. If rerun on the same image, it applied the change in shift between
            the current and previous run.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">UpdateItemZ</TD>
          <TD>Assign current stage Z value to the current Navigator item, or item that this
            macro is being run on.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">UpdateGroupZ</TD>
          <TD>Assign current stage Z value to the whole group that the current Navigator
            item, or item that this macro is being run on, belongs to. The item must have a
            non-zero group ID. If the group would show up on more than one line with
            'Collapse groups' on, items on all lines will be updated, unlike with the
            'Update Z' button.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ReportNavItem</TD>
          <TD>Report the index, stage X, Y, Z, label, and note string for the current
            Navigator item, or the item this macro is being run on. The index and stage
            coordinates are placed in 'reportedValue' variables as usual, and the item type
            is placed in 'reportedValue5' (0 for point, 1 for polygon, 2 for map). In
            addition, variables 'navLabel', and 'navNote' are set with the label and note
            strings, and variables 'navIndex' and 'navIntLabel' are set with integer values
            of the item index (numbered from 1) and of the label (up to any non-numeric characters).
            If the Navigator is currently acquiring at points, a variable &#39;navAcqIndex&#39; is
            set with the number of items already acquired plus 1.&nbsp; Any of
            these variables can then be used to make filenames, and the latter two can be
            used in arithmetic and IF statements.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ReportOtherItem #</TD>
          <TD>Report similarly on the Navigator item whose index in the table is #, numbered
            from 1.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ReportGroupStatus</TD>
          <TD>For the current Navigator item or the item this macro is being run on, reports a code for whether the
            item is first to be acquired in a group: -1 if Navigator not acquiring, 0 if
            not in a group, 1 if first to be acquired in a group, 2 if later in the group.
            If the group would show up on more than one line with 'Collapse groups' on, a
            value of 1 is returned for the first item to be acquired in each subgroup.&nbsp;
            It also reports the group ID of the item&nbsp; (ID is 0 for an item not in a
            group).</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">ItemForSuperCoord #</TD>
          <TD>Set the item number that Navigator supplies supermontage coordinates from when
            a montage image is acquired. Set the number to 0 to restore Navigator to using
            coordinates from the item currently being acquired.</TD>
        </TR>
        <TR vAlign="top">
          <TD class="style5">SkipPiecesOutsideItem #</TD>
          <TD>Sets the current montage to skip pieces outside the Navigator item whose
            position in the table is # (numbered from 1). If # is 0, uses the current item.
            If # is &lt; 0, disables the skipping of pieces.</TD>
        </TR>
      </TABLE>
      <BR>
      <P><A name="miscellaneous"></A><B>Miscellaneous Commands</B></P>
      <TABLE border="1" cols="2">
        <TR vAlign="top">
          <TD width="210">CircleFromPoints x y x y x y</TD>
          <TD>Report the X and Y center coordinate and the radius in microns for the circle
            through three points whose coordinates are given on the line as x1 y1 x2 y2 x3
            y3.</TD>
        </TR>
        <TR vAlign="top">
          <TD width="210">ReportClock</TD>
          <TD>Report seconds elapsed since last ResetClock command</TD>
        </TR>
        <TR vAlign="top">
          <TD width="210">ResetClock</TD>
          <TD>Reset the time reported by ReportClock to 0</TD>
        </TR>
        <TR vAlign="top">
          <TD width="210">ProgramTimeStamps</TD>
          <TD>Prints the program version and build date, and the current date and time.</TD>
        </TR>
        <TR>
          <TD width="207">Plugin name func [args]</TD>
          <TD>Call&nbsp;the function 'func' in the plugin named 'name' with&nbsp;appropriate
            list of arguments for that function.&nbsp; Arguments are entered as items
            separated by spaces, except that a string argument at the end may consist of
            multiple words.&nbsp; The return value of the function is reported and placed
            into reportedValue1.</TD>
        </TR>
        <TR>
          <TD width="210">ListPluginCalls</TD>
          <TD>List the names of macro-callable functions in all loaded plugins along with the
            arguments that they expect, in parentheses.&nbsp; For each argument, there
            should be one item provided on the command line calling the function, with all
            items separated by spaces as usual.&nbsp; Two exceptions to this are: a string
            argument at the end can include spaces; an argument listed as [out]double is a
            returned value, assigned to reportedValue2 or higher.</TD>
        </TR>
        <TR vAlign="top">
          <TD width="210">MailSubject text</TD>
          <TD>Subject line for an email message (default is 'Message from SerialEM macro').
            The text can include variables to be substituted.</TD>
        </TR>
        <TR vAlign="top">
          <TD width="210">SendEmail text</TD>
          <TD>Send an email containing the given text, which can include variables to be
            substituted. An SMTP server and address to send from must be defined in the
            properties file, and recipient(s) must be defined using 'Set Email Address' in
            the Tilt Series Menu.</TD>
        </TR>
      </TABLE>
    </basefont>
  </BODY>
</HTML>
